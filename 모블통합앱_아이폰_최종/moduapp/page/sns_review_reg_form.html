<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' gap:; style-src 'self' 'unsafe-inline'; script-src 'self' http://* 'unsafe-eval' 'unsafe-inline'; img-src 'self' data: http:; media-src *"/>
	<title>리뷰등록</title>
	<link rel="stylesheet" type="text/css" href="../css/default.css"/>
	<link rel="stylesheet" type="text/css" href="../css/style.css"/>
	<link rel="stylesheet" type="text/css" href="../css/nav.css"/>
	<link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
	<link rel="stylesheet" type="text/css" href="../css/iphone.css"/>
	<script src="../js/jquery.min.js"></script>
	<script src="../js/jquery.form.min.js"></script>
	<script src="../js/swiper.min.js"></script>
	<script src="../js/menu.js"></script>
	<script src="../../cordova.js"></script>
</head>
<style>
input[type="checkbox"], input[type="radio"] {-moz-appearance: none;-webkit-appearance: none; -ms-appearance: none;appearance: none;display: none;float: left; margin-right: -2em;opacity: 0;width: 1em;z-index: -1;}
input[type="checkbox"] + label, input[type="radio"] + label {padding-left:18px;  text-decoration: none;color: #585858;cursor: pointer; display: inline-block; font-weight: 300; padding-left: 2em; /* padding-right: 1.75em; */ position: relative;}
input[type=radio]:checked + label span {background:url(../img/icon_check.png)no-repeat;background-size: 15px 15px;border: none;width: 15px;height: 15px;}
input[type=radio] + label span {position: absolute;top: 2px;left: 0;width: 13px;height: 13px;border: 1px solid #747474;border-radius: 4px;overflow: hidden;}
</style>
<body>
	<div class="iphone_top"></div>
	<div id="header">
		<h1>리뷰등록</h1>
		<a href="javascript:history.back();" class="header_btn_l btn_back">뒤로</a>
	</div>
	<form id="review_reg_form" method="post">
	<input type="hidden" name="w" id="w" value="" id="w">
	<input type="hidden" name="bo_table" value="sns_review">
	<input type="hidden" name="wr_6" value="" id="wr_6">
	<input type="hidden" name="mb_id" value="" id="mb_id">
	<input type="hidden" name="wr_id" value="" id="wr_id">
	<input type="hidden" name="c_divide" value="sns_review">
	<input type="hidden" name="comment_id" id="comment_id" value="">
	
	<div class="bk_gray">
		<div class="m_reg_li" style="overflow:hidden">
			<p class="title rg_title" id="wr_subject"></p>
			<ul>
				<li>
					<label class="title" for="local">평점</label>
					<div class="dv_input">
						<div class="input_txt star_wrap">
							<div class="re_star">
								<span id="s_1" value="1" class="star"><img src="../img/star_off.png"></span>
								<span id="s_2" value="2" class="star"><img src="../img/star_off.png"></span>
								<span id="s_3" value="3" class="star"><img src="../img/star_off.png"></span>
								<span id="s_4" value="4" class="star"><img src="../img/star_off.png"></span>
								<span id="s_5" value="5" class="star"><img src="../img/star_off.png"></span>
								<input type="hidden" id="wr_7" name="wr_7" value="">
							</div>
						</div>
					</div>
				</li>
				<li>
					<p class="title">내용</p>
					<div class="dv_input">
						<div class="input_txt">
							<textarea class="rg_cont" name="wr_content" id="wr_content" placeholder="내용 입력"></textarea>
						</div>
					</div>
				</li>
				<li>
					<label class="title" for="data1">리뷰<span class="reg_t_sub"> ('URL 선택하기'는 인스타그램만 가능합니다.)</span></label>
					<div id="rv_rs">
						<div class="dv_input" style="margin-bottom:10px" id="select-review">
							<div id="select_review" style="padding:13px 0">
								<div id="select1"><input type="radio" id="ra1" name="selectImg" value="" class="btn_chk" checked><label for="ra1" id="lbl-ra2">URL 입력하기<span></span></label></div>
								<span>|</span>
								<div id="select2" style="cursor:pointer"><input type="radio" id="ra2" name="selectImg" value=""><label for="ra2" id="lbl-ra1">사진 선택하기<span></span></label></div>
							</div>
						</div>
						<div id="select-img">
							<div class="swiper-container1">
								<div class="swiper-wrapper" id="rv_list_sns"> 
								
								</div>
							</div>
						</div>
						
						<div id="frame_sns">
						</div>
					</div>
					<div id="select-url">
						<div class="dv_input" style="margin-bottom:10px">
							<div class="input_txt">
								<input class="input rv_input wr_1" type="text" name="wr_1" placeholder="SNS에 등록한 사진 링크를 복사·붙여넣기 해주세요." required>
							</div>
						</div>
						<div class="dv_input">
							<div class="input_txt">
								<input class="input rv_input wr_1_2" type="text" name="wr_1_2" placeholder="SNS에 등록한 사진 링크를 복사·붙여넣기 해주세요." required>
							</div>
						</div>
					</div>
				</li>
			</ul>
		</div>
		<div style="padding:0 16px 20px">
			<div class="btn_wrap btn_ok">
				<a href="#none" id="btn_submit" class="btn_submit">등록하기</a>
			</div>
			<div class="bottom_txt">리뷰등록에 문제가 있을 시 1:1 문의에<br>내용을 남겨주시면 친절히 안내해드리겠습니다.</div>
			<div class="bottom_txt bt_footer">광고/제휴문의 고객센터 02-3144-2110<br>일반회원 고객센터 02-6392-2121</div>
		</div>
		</form>
	</div>
	<script>
	//리뷰 제출방법 선택
	$(document).ready(function(){
		$("#select_review").click(function(){
			if($("#ra1").is(":checked")){
				$(".selected").attr("class","not_sel");
				num = 0;
				$("#lbl-ra1").css("color","#acacac");
				$("#lbl-ra2").css("color","#585858");
				$("#select-url").css("display","block");
				$("#select-img").css("display","none");
			}else if($("#ra2").is(":checked")){
				$("#select-url").children().children("input").val("");
				$("#lbl-ra1").css("color","#585858");
				$("#lbl-ra2").css("color","#acacac");
				$("#select-url").css("display","none");
				$("#select-img").css("display","block");
			}
		});
	});
	
	//사진선택
	var limit = 2;
	var num = 0;
	$(document).on('click','#rv_list_sns a',function(){
		var linked = $(this).attr("href");
		var class_n = $(this).attr("class");
		var data = $(this).attr("data");

		if(class_n == "not_sel"){
			if(num == limit){
				alert("최대 2개까지만 선택 가능합니다.");
			}else{	
				$(this).removeClass();
				$(this).addClass('selected');
				if($(".wr_1").val() == ""){
					$(".wr_1").val(linked);
					$(".wr_1").attr("id",data);
				}else if($(".wr_1_2").val() == ""){
					$(".wr_1_2").val(linked);
					$(".wr_1_2").attr("id",data);
				}
				num = num + 1;
				$('.btn_ok  a').addClass('on');
			}
		}else if(class_n === 'selected'){
			$(this).removeClass();
			$(this).addClass('not_sel');
			if(data == $(".wr_1_2").attr("id")){
				$(".wr_1_2").val("");
			}else if(data == $(".wr_1").attr("id")){
				$(".wr_1").val("");
			}
			
			if($(".wr_1").val() == "" && $(".wr_1_2").val() == ""){
				$('.btn_ok  a').removeClass('on');
			}
			num = num - 1;
		}

		return false;
	});

	// 평점
	$(".re_star .star").click(function(){
		$(".star").children().attr("src","../img/star_off.png");
		var star_id = $(this).attr("id");
		star_id = star_id.replace("s_","");
		for(var i=1;i<6;i++){
			if(i<=star_id){
				$("#s_"+i).children().attr("src","../img/star_on_sns.png");
			}
		}
		var point = star_id * 2;
		$("#wr_7").val(point);
		
		return false;
	});

	// 사진선택하기 클릭
	$(document).on('click','#select2',function(){
		//$(this).toggleClass("on");
		//var ref = window.open("https://www.instagram.com/oauth/authorize/?client_id=104747e1329a4431803da088bf4270c6&redirect_uri=http://modublog.co.kr/app_public/ajax/a_sns_review.php&response_type=code","_blank","location=no");
		var ref = cordova.InAppBrowser.open("https://www.instagram.com/oauth/authorize/?client_id=104747e1329a4431803da088bf4270c6&redirect_uri=http://modublog.co.kr/app_public/ajax/a_sns_review.php&response_type=code","_blank","location=no");
			
		ref.addEventListener("loadstop", function(location){
			if (location.url.indexOf('code')!= -1) {
				var str = location.url;
				str = str.replace("http://modublog.co.kr/app_public/ajax/a_sns_review.php?", "");
				
				var code = getQuerystrings(str,'code');	
                             
                        
				ref.close();

				var params = {"code":code};
			    $.ajax({      
			        type:"POST",  
			        url:"http://modublog.co.kr/app_public/ajax/a_sns_review.php",      
			        data:params,      
			        success:function(args){   
						if(!args || args.length <= 0){
							 $("#rv_list_sns").html('<p style="text-align:center;font-size:11px;">사진 선택은 인스타그램만 가능합니다.<br>불러올 사진이 있는지 확인해주세요.</p>');
						}else{
							$("#rv_list_sns").html(args);   
						}
						//사진 slide 
						var swiper = new Swiper('.swiper-container1', {
							slidesPerView: 'auto',
							loop: false,
							spaceBetween: 13,
						}); 
			        },   
			        error:function(e){  
			            alert(e.responseText);  
			        }  
			    });
                             
			}
		});
		
	});	
	// 블로그 리뷰 선택
	/*$(document).on("click",".rv_title",function(){
		$(".rv_title").css("background","none");
		$(this).css("background","#f2f2f2");
		
		var link = $(this).children("a").attr("href");
		var text = $(this).children("a").html();
		
		if($(".wr_1").val() != ''){
			$(".wr_1_2").val(link);
		}else{
			$(".wr_1").val(link);
		}
		
		$(".rv_list_blog").removeClass("on");
		$(".rv_select").html(text);
		
		//리뷰 선택입력 - URL이 있을때 버튼 on
		if($(".wr_1").val().length > 0 || $(".wr_1").val().length > 0){
			$('.btn_ok > a').addClass('on');
		}else{
			$('.btn_ok > a').removeClass('on');
		}
		return false;
	})
	*/
	
	// 리뷰 직접입력 - URL이 있을때 버튼 on
	$('.rv_input').keyup(function(){
		var wr_1 = $('.wr_1').val();
		var wr_1_2 = $('.wr_1_2').val();
		
		if(wr_1.length > 0 || wr_1_2.length > 0){
			$('.btn_ok  a').addClass('on');
		}else{
			$('.btn_ok  a').removeClass('on');
		}
	})
	
	$(document).ready(function(){
		// 인스타그램 사진 불러오기
		var mb_id = member['mb_id'];
		var params = {"mb_id":mb_id};
		var string = '';
		/*$.ajax({      
			type:"POST",  
			url:"http://modublog.co.kr/app_public/ajax/a_review_blog.php",   
			data:params,
			success:function(data){
				$.each(data[0],function(key,value){
					string += '<li class="rv_title"><a href="'+value.rv_link[0]+'"><span class="txt_ov">'+value.rv_title[1]+'</span></a></li>';
				})
				$('#rv_list').html(string);
				//console.log(data);
			},   
			error:function(e){  
				console.log(e.responseText);  
			}  
		});  */
		
		// 리뷰 등록|수정 구분
		var w = getQuerystring('w');
		$("#w").val(w);
		
		// 리뷰 수정일 때 리뷰 불러오기
		if(w == "cu"){
			$('#select-review').hide();	//블로그 불러오기 hide
			$('#select-img').hide();	//블로그 불러오기 hide
			$('#select-url').show();
			$('.btn_ok > a').addClass('on');	//버튼 on
			
			var bo_table = getQuerystring('bo_table');
			var wr_id = getQuerystring('wr_id');
			var mb_id = member['mb_id'];
			var params = {"mb_id":mb_id,"wr_id":wr_id,"bo_table":bo_table};
			$.ajax({      
				type:"POST",  
				url:"http://modublog.co.kr/app_public/ajax/a_review_update.php",   
				data:params,
				success:function(data){
					$.each(data,function(key,value){
						$('#wr_subject').text(data.wr_subject);
						if(key == 'wr_1' || key == 'wr_1_2'){
							$("."+key).val(value);
						}
						if(key == 'wr_content'){
							$("#"+key).val(value);
						}
						var star_p = data.wr_7/2;
						for(var i=1;i<6;i++){
							if(i <= star_p){
								$("#s_"+i).children().attr("src","../img/star_on_sns.png");
							}
						}
						var point = star_p * 2;
						$("#wr_7").val(point);
						$("#comment_id").val(data.comment_id);
					})
					console.log(data);
				},   
				error:function(e){  
					console.log(e.responseText);  
				}  
			});  
		}
	})
	
	// 등록버튼 클릭
	$(document).on('click','.btn_submit.on',function(){
		var wr_6 = getQuerystring('ms_id');
		var wr_id = getQuerystring('wr_id');
		var mb_id = member['mb_id'];
		$('#mb_id').val(mb_id);
		$('#wr_id').val(wr_id);
		$('#wr_6').val(wr_6);
		
		if ($('#wr_7').val() == "") {
			alert("별점을 남겨주세요.");
			$('.re_star').focus();
			return false;
		}
		if ($('#wr_content').val() == "") {
			alert("내용을 입력해주세요.");
			$('#wr_content').focus();
			return false;
		}
		if ($('#wr_1').val() == ""){
			alert("리뷰 URL을 선택 또는 입력해주세요.");
			$('#wr_1').focus();
			return false;
		}
		$(this).attr("class","btn_submit off");
		
		var params = $(this).closest("form").serialize();
		
		$.ajax({      
			type:"POST",  
			url:"http://modublog.co.kr/app_public/ajax/a_comment_write.php",  
			data:params,			
			success:function(data){
				location.href="mypage_01.html";
				//console.log(data); 
			},   
			error:function(e){  
				console.log(e.responseText);  
			}  
		});
	})
	</script>
</body>
</html>
