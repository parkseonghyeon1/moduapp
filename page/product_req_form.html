<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' gap:; style-src 'self' 'unsafe-inline'; script-src 'self' http://* 'unsafe-eval' 'unsafe-inline'; img-src 'self' data: http:; media-src *"/>
	<title>신청하기</title>
	<link rel="stylesheet" type="text/css" href="../css/default.css"/>
	<link rel="stylesheet" type="text/css" href="../css/style.css"/>
	<link rel="stylesheet" type="text/css" href="../css/nav.css"/>
	<script src="../js/jquery.min.js"></script>
	<script src="../js/jquery.form.min.js"></script>
	<script src="../js/menu.js"></script>
</head>
</html>
<script>
	$(document).ready(function(){
		//var mb_id = member['mb_id'];
		var mb_id = getQuerystring('mb_id');
		var bo_table = getQuerystring('bo_table');
		var wr_id = getQuerystring('wr_id');
		
		$(".request").attr("src","http://modublog.co.kr/app_public/product_req_form.php?bo_table="+bo_table+"&wr_id="+wr_id+"&mb_id="+mb_id);
	})
</script>	
<body>
	<div id="header">
		<h1>신청하기</h1>
		<a href="javascript:history.back();" class="header_btn_l btn_back">뒤로</a>
	</div>
	<form id="review_reg_form1" name="review_reg_form1" method="post" enctype="multipart/form-data">
		<input type="hidden" name="mb_id" id="mb_id" val="">
		<input type="hidden" name="bo_table" id="bo_table" val="">
		<input type="hidden" name="wr_id" id="wr_id" val="">
		<input type="hidden" name="wr_20" id="wr_20" val="">
		<input type="hidden" name="mb_zip" id="mb_zip" val="">
		<input type="hidden" name="mb_addr1" id="mb_addr1" val="">
		<input type="hidden" name="mb_addr2" id="mb_addr2" val="">
		<input type="hidden" name="mb_hp1" id="mb_hp1" val="">
		<input type="hidden" name="mb_hp2" id="mb_hp2" val="">
		<input type="hidden" name="mb_hp3" id="mb_hp3" val="">
		<input type="hidden" name="wr_content2" id="wr_content2" val="">
		<input type="hidden" name="wr_content" id="wr_content" val="">
		<input type="hidden" name="wr_subject" id="wr_subject" val="">
		<input type="hidden" name="wr_review" id="wr_review"  val="">
		<input type="hidden" name="mb_homepage" id="mb_homepage" val="">
		<input type="hidden" name="wr_3" id="wr_3" val="">
	</form>
		<div>
		<iframe id="product_req_frame" name="product_req_frame" src="http://modublog.co.kr/app_public/product_req_form.php" width="100%" class="request" height="600px;" frameborder="0"></iframe>
		</div>
	<div class="m_reg_li terms_wrap">
		<p class="title">약관동의</p>
		<div class="terms_use terms_all">
			<p>모두동의</p>
			<input type="checkbox" id="chk_all">
			<label for="chk_all"><span></span></label>
		</div>
		<em class="em_b"></em>
		<div class="terms_use">
			<span class="ct">[필수]</span><a href="#none">체험단 이용약관</a>
			<input type="checkbox" id="chk_1" name="check">
			<label for="chk_1"><span></span></label>
		</div>
		<div class="terms_use">
			<span class="ct">[필수]</span><a href="#none">체험단 안내사항</a>
			<input type="checkbox" id="chk_2" name="check">
			<label for="chk_2"><span></span></label>
		</div>
	</div>
	<div class="reg_btn">
		<div class="btn_wrap btn_ok">
			<a id="btn_submit">신청하기</a>
		</div>
		<div class="bottom_txt">신청하기에 문제가 있을 시 1:1 문의에<br>내용을 남겨주시면 친절히 안내해드리겠습니다.</div>
		<div class="bottom_txt bt_footer">광고/제휴문의 고객센터 02-3144-2110<br>일반회원 고객센터 02-6392-2121</div>
	</div>
		
</body>
<script>
	$(document).ready(function(){
		// 전체동의 선택 시 모든 체크박스 상태 checked true|false
		$('#chk_all').click(function(){
			if($('#chk_all').prop('checked')){
				$('input[name=check]').prop('checked',true);
				$('.btn_ok > a').addClass('on');
			}else{
				$('input[name=check]').prop('checked',false);
				$('.btn_ok > a').removeClass('on');
			}
		})
		// 모든 체크박스 checked 일 때 확인 버튼 on
		$('input[name=check]').click(function(){
			if($('#chk_1').prop('checked') && $('#chk_2').prop('checked')){
				$('.btn_ok > a').addClass('on');
			}else{
				$('.btn_ok > a').removeClass('on');
			}
		})
	})

	$(document).on('click','#btn_submit',function(){
		
		var zip = $("#product_req_frame").contents().find("#review_reg_form").serialize();
		//var zip = $(".product_req_frame").contents().find("#mb_id").val();
		
		
		var dataList = zip.split("&");
		var dataList_length = dataList.length;

		var data = new Array();
		for( i=0; i<dataList_length; i++ )
		{
		   var data2 = dataList[i].split("=");  //dataList 각 배열의 값을 '=' 문자로 배열로 저장한다.
		   data[data2[0]] = data2[1];  //data 배열의 인덱스는 data2[0]로 설정하고 값은 data2[1]로 저장
		   
		}
		
		function string_change(data){
			return data.replace(/%21/gi,"!").replace(/%23/gi,"#").replace(/%24/gi,"&").replace(/%26/gi,"&").replace(/%27/gi,"'").replace(/%28/gi,"(").replace(/%29/gi,")").replace(/%2A/gi,"*").replace(/%2B/gi,"+").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%3A/gi,":").replace(/%3B/gi,";").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%40/gi,"@").replace(/%5B/gi,"[").replace(/%5D/gi,"]").replace(/%20/gi," ").replace(/%22/gi,'"').replace(/%25/gi,"%").replace(/%2D/gi,"-").replace(/%2E/gi,".").replace(/%3C/gi,"<").replace(/%3E/gi,">").replace(/%5C/gi,"\'").replace(/%5E/gi,"^").replace(/%5F/gi,"_").replace(/%60/gi,"`").replace(/%7B/gi,"{").replace(/%7C/gi,"|").replace(/%7D/gi,"}").replace(/%7E/gi,"~");
		}

		function string_blank(data){
			return data.replace(/\+/gi," ");
		}

		var agree1 = $('#chk_1:checkbox:checked').val();
		var agree2 = $('#chk_2:checkbox:checked').val();
		if(agree1 != 'on' || agree2 != 'on'){
			alert("이용약관에 동의해주세요.");
			return false;
		}
		
		if(data['wr_20'] == 1){	//배송일때
			$('#mb_zip').val(data['mb_zip']);
			$('#mb_addr1').val(string_blank(decodeURI(data['mb_addr1'])));
			$('#mb_addr2').val(string_blank(decodeURI(data['mb_addr2'])));
			$('#mb_hp1').val(data['mb_hp1']);
			$('#mb_hp2').val(data['mb_hp2']);
			$('#mb_hp3').val(data['mb_hp3']);
			$('#wr_content2').val(string_blank(decodeURI(data['wr_content2'])));	
			$('#wr_content').val(string_blank(decodeURI(data['wr_content'])));
			$('#mb_homepage').val(string_change(data['mb_homepage']));						

			var mb_zip = $('#mb_zip').val();
			var mb_addr1 = $('#mb_addr1').val();
			var mb_addr2 = $('#mb_addr2').val();
			var mb_hp1 = $('#mb_hp1').val();
			var mb_hp2 = $('#mb_hp2').val();
			var mb_hp3 = $('#mb_hp3').val();
			var wr_content2 = $('#wr_content2').val();
			var wr_content = $('#wr_content').val();
			var mb_homepage = $('#mb_homepage').val();
			if(mb_zip == ''){
			alert("우편번호를 입력하세요.");
			$("#mb_zip").focus();
			return false;
			}
			if(mb_addr1 == ''){
			alert("주소를 입력하세요.");
			$("#mb_addr1").focus();
			return false;
			}
			if(mb_addr2 == ''){
			alert("나머지주소를 입력하세요.");
			$("#mb_addr2").focus();
			return false;
			}
			if(mb_hp1 == ''){
			alert("핸드폰번호를 입력하세요.");
			$("#mb_hp1").focus();
			return false;
			}
			if(mb_hp2 == ''){
			alert("핸드폰번호를 입력하세요.");
			$("#mb_hp2").focus();
			return false;
			}
			if(mb_hp3 == ''){
			alert("핸드폰번호를 입력하세요.");
			$("#mb_hp3").focus();
			return false;
			}
			if(wr_content2 == ''){
			alert("특이사항을 입력하세요.");
			$("#wr_content2").focus();
			return false;
			}
			if(wr_content == ''){
			alert("신청사연을 입력하세요.");
			$("#wr_content").focus();
			return false;
			}
			if(mb_homepage == ''){
			alert("블로그주소를 입력하세요.");
			$("#mb_homepage").focus();
			return false;
			}

		}

		if(data['wr_3']){	//상품선택일때

			$('#wr_3').val(string_change(decodeURI(data['wr_3'])));	
			$('#mb_homepage').val(string_change(data['mb_homepage']));
			$('#wr_content').val(string_blank(decodeURI(data['wr_content'])));
			var wr_3 = $('#wr_3').val();
			var wr_content = $('#wr_content').val();
			var mb_homepage = $('#mb_homepage').val();
			if(wr_content == ''){
			alert("신청사연을 입력하세요.");
			$("#wr_content").focus();
			return false;
			}
			if(mb_homepage == ''){
			alert("블로그주소를 입력하세요.");
			$("#mb_homepage").focus();
			return false;
			}
		}

		$('#mb_id').val(decodeURI(data['mb_id']));
		$('#bo_table').val(decodeURI(data['bo_table']));
		$('#wr_id').val(data['wr_id']);
		$('#wr_20').val(data['wr_20']);
		$('#wr_subject').val(string_blank(string_change(decodeURI(data['wr_subject']))));	
		$('#wr_review').val(string_blank(decodeURI(data['wr_review'])));
		$('#mb_homepage').val(string_change(data['mb_homepage']));
		$('#wr_content').val(string_blank(decodeURI(data['wr_content'])));
		var wr_content = $('#wr_content').val();
		var mb_homepage = $('#mb_homepage').val();
		if(wr_content == ''){
			alert("신청사연을 입력하세요.");
			$("#wr_content").focus();
			return false;
		}
		if(mb_homepage == ''){
			alert("블로그주소를 입력하세요.");
			$("#mb_homepage").focus();
			return false;
		}

		var params = string_change(string_blank(decodeURI($("#review_reg_form1").serialize())));
		
		$.ajax({      
			type:"POST",  
			url:"http://modublog.co.kr/app_public/ajax/a_request.php",  
			data:params,			
			success:function(data){
				//alert(data);
				alert("신청이 완료되었습니다");
				location.replace("mypage_01.html");
			},   
			error:function(e){  
				//alert(e.responseText);  
			}  
		});	
		
		
		
	})
	
</script>


<!-- 안재현 작업해야한다~  -->
